<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Flipsky VESC 4.12 Documentation" href="../bonus/vesc_doc.html" /><link rel="prev" title="Electronics" href="electronics.html" />

    <meta name="generator" content="sphinx-4.0.3, furo 2021.07.05.beta38"/>
        <title>Software - momobot 1.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css" />
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">momobot 1.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/MOMO_logo_full.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">momobot 1.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="electronics.html">Electronics</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Software</a></li>
</ul>
<p class="caption"><span class="caption-text">Extra</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bonus/vesc_doc.html">Flipsky VESC 4.12 Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bonus/cd_links.html">Circuit Diagram Draw.io Links</a></li>
</ul>
<p class="caption"><span class="caption-text">Credits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../credits/contributions.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits/license.html">License</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <section id="software">
<h1>Software<a class="headerlink" href="#software" title="Permalink to this headline">¶</a></h1>
<p>MOMObot is using a modified <a class="reference external" href="https://linorobot.org">Linorobot</a> stack!</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>ROS Melodic Morenia</p></li>
<li><p>Jetpack 4.4.1, L4T 32.4.4 [Ubuntu 18.04.5 LTS]</p></li>
</ul>
<p><strong>Linorobot to Momobot stack changes:</strong></p>
<ol class="arabic simple">
<li><p>Changed Linorobot to Momobot names in code</p></li>
<li><p>Changed motor driver code</p></li>
<li><p>Retargeted several packages</p></li>
</ol>
</section>
<section id="pre-requisites">
<h2>3.1 Pre-Requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>ROS Proficiency</p></li>
<li><p>Intermediate Linux/Ubuntu Command Line Proficiency</p></li>
<li><p>Python3 &amp; C++ [Good to have]</p></li>
<li><dl class="simple">
<dt>Linorobot experience</dt><dd><ul>
<li><p><a class="reference external" href="https://linorobot.org">https://linorobot.org</a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<section id="platformio">
<h3>platformio<a class="headerlink" href="#platformio" title="Permalink to this headline">¶</a></h3>
<p>Would be used to flash the teensy firmware, install via <cite>pip3 install</cite>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo pip3 install platformio
</pre></div>
</div>
</section>
<section id="pygame">
<h3>pygame<a class="headerlink" href="#pygame" title="Permalink to this headline">¶</a></h3>
<p>Ensure that pygame is installed before running <em>momo_emotions</em>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install python-pygame
</pre></div>
</div>
</section>
<section id="ros-packages">
<h3>ROS Packages<a class="headerlink" href="#ros-packages" title="Permalink to this headline">¶</a></h3>
<p>Ensure that the relevant ROS pacakages are installed:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/cra-ros-pkg/robot_localization">Robot Localization</a></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt install ros-melodic-robot-localization
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="http://wiki.ros.org/rosserial">Ros Serial Python</a></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt install ros-melodic-rosserial-python
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="http://wiki.ros.org/imu_filter_madgwick">imu_filter_madgwick</a></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt install ros-melodic-imu-filter-madgwick<span class="sb">``</span>
</pre></div>
</div>
</section>
<section id="teensy">
<h3>Teensy<a class="headerlink" href="#teensy" title="Permalink to this headline">¶</a></h3>
<section id="setup">
<h4>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h4>
<p>The teensy driver could be downloaded from their
<a class="reference external" href="https://www.pjrc.com/teensy/td_download.html">website</a>.</p>
<p>1. Download the udev rules for the teensy and copied it to the
<code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d/</span></code> directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wget https://www.pjrc.com/teensy/49-teensy.rules      <span class="c1">#To download the udev rules</span>

$ sudo cp <span class="m">49</span>-teensy.rules /etc/udev/rules.d/
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Ensure that Arduino has been installed beforehand, if not install the
relevant linux package from their <a class="reference external" href="https://www.arduino.cc/en/software/">webpage</a>.
(The Jetson Nano uses the 64bit ARM architecture.)</p></li>
<li><p>Download the corresponding Teensyduino installer, in our case would be the
<code class="docutils literal notranslate"><span class="pre">AARCH64</span></code> package <a class="reference external" href="https://www.pjrc.com/teensy/td_153/TeensyduinoInstall.linuxaarch64">here</a>.</p></li>
<li><p>Add the execute permission to the installer script and then execute it.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ chmod <span class="m">755</span> TeensyduinoInstall.linux64
$ ./TeensyduinoInstall.linux64
</pre></div>
</div>
</section>
<section id="configuration">
<h4>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h4>
<p>To access the Teensy, change the access permission of the Teensy via <cite>chmod</cite>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo chmod <span class="m">777</span> /dev/ttyACM0
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Replace <code class="docutils literal notranslate"><span class="pre">/dev/ttyACM0</span></code> to the device port of the Teensy accordingly!</p>
</div>
<p>To make it easier to identify teensy, we’ll attach a symbolic link to the
device name. We’ll bind the teensy to a symbolic link (custom name) via udev
(So instead of <code class="docutils literal notranslate"><span class="pre">/dev/ttyACM0</span></code>, it would be <code class="docutils literal notranslate"><span class="pre">/dev/momobase</span></code>). Double check the
attributes of the device.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ udevadm info -a -p  <span class="k">$(</span>udevadm info -q path -n /dev/ttyACM0<span class="k">)</span>
</pre></div>
</div>
<p>Teensy could be identified via <code class="docutils literal notranslate"><span class="pre">ATTRS{manufacturer}=="Teensyduino"</span></code> in the
list, <strong>Note down the values of ``ATTRS{idVendor}`` and ``ATTRS{idProduct}``.</strong>
The output would look something like this as shown below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>looking at parent device <span class="s1">'/devices/70090000.xusb/usb1/1-2/1-2.4'</span>:
  <span class="nv">KERNELS</span><span class="o">==</span><span class="s2">"1-2.4"</span>
  <span class="nv">SUBSYSTEMS</span><span class="o">==</span><span class="s2">"usb"</span>
  <span class="nv">DRIVERS</span><span class="o">==</span><span class="s2">"usb"</span>
  ATTRS<span class="o">{</span>authorized<span class="o">}==</span><span class="s2">"1"</span>
  ATTRS<span class="o">{</span>avoid_reset_quirk<span class="o">}==</span><span class="s2">"0"</span>
  ATTRS<span class="o">{</span>bConfigurationValue<span class="o">}==</span><span class="s2">"1"</span>
  ATTRS<span class="o">{</span>bDeviceClass<span class="o">}==</span><span class="s2">"02"</span>
  ATTRS<span class="o">{</span>bDeviceProtocol<span class="o">}==</span><span class="s2">"00"</span>
  ATTRS<span class="o">{</span>bDeviceSubClass<span class="o">}==</span><span class="s2">"00"</span>
  ATTRS<span class="o">{</span>bMaxPacketSize0<span class="o">}==</span><span class="s2">"64"</span>
  ATTRS<span class="o">{</span>bMaxPower<span class="o">}==</span><span class="s2">"100mA"</span>
  ATTRS<span class="o">{</span>bNumConfigurations<span class="o">}==</span><span class="s2">"1"</span>
  ATTRS<span class="o">{</span>bNumInterfaces<span class="o">}==</span><span class="s2">" 2"</span>
  ATTRS<span class="o">{</span>bcdDevice<span class="o">}==</span><span class="s2">"0275"</span>
  ATTRS<span class="o">{</span>bmAttributes<span class="o">}==</span><span class="s2">"c0"</span>
  ATTRS<span class="o">{</span>busnum<span class="o">}==</span><span class="s2">"1"</span>
  ATTRS<span class="o">{</span>configuration<span class="o">}==</span><span class="s2">""</span>
  ATTRS<span class="o">{</span>devnum<span class="o">}==</span><span class="s2">"7"</span>
  ATTRS<span class="o">{</span>devpath<span class="o">}==</span><span class="s2">"2.4"</span>
  ATTRS<span class="o">{</span>idProduct<span class="o">}==</span><span class="s2">"0483"</span>                        &lt;<span class="o">====</span> Take note of this
  ATTRS<span class="o">{</span>idVendor<span class="o">}==</span><span class="s2">"16c0"</span>                         &lt;<span class="o">====</span> And this
  ATTRS<span class="o">{</span>ltm_capable<span class="o">}==</span><span class="s2">"no"</span>
  ATTRS<span class="o">{</span>manufacturer<span class="o">}==</span><span class="s2">"Teensyduino"</span>
  ATTRS<span class="o">{</span>maxchild<span class="o">}==</span><span class="s2">"0"</span>
  ATTRS<span class="o">{</span>product<span class="o">}==</span><span class="s2">"USB Serial"</span>
  ATTRS<span class="o">{</span>quirks<span class="o">}==</span><span class="s2">"0x0"</span>
  ATTRS<span class="o">{</span>removable<span class="o">}==</span><span class="s2">"unknown"</span>
  ATTRS<span class="o">{</span>serial<span class="o">}==</span><span class="s2">"2952920"</span>
  ATTRS<span class="o">{</span>speed<span class="o">}==</span><span class="s2">"12"</span>
  ATTRS<span class="o">{</span>urbnum<span class="o">}==</span><span class="s2">"10"</span>
  ATTRS<span class="o">{</span>version<span class="o">}==</span><span class="s2">" 1.10"</span>
</pre></div>
</div>
<p>After that, open up <code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d/99-nv-l4t-usb-device-mode.rules</span></code>
with a text editor.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Double check the files in the <code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d/</span></code> directory, the device rule
file may differ for different devices/computer.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo nano /etc/udev/rules.d/99-nv-l4t-usb-device-mode.rules
</pre></div>
</div>
<p>Add the following line.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ACTION</span><span class="o">==</span><span class="s2">"add"</span>, ATTRS<span class="o">{</span>idVendor<span class="o">}==</span><span class="s2">"16c0"</span>, ATTRS<span class="o">{</span>idProduct<span class="o">}==</span><span class="s2">"0483"</span>, <span class="nv">SYMLINK</span><span class="o">+=</span><span class="s2">"momobase"</span>
</pre></div>
</div>
<p>Disconnect and reconnect the teensy for the change to take affect. Listing
<code class="docutils literal notranslate"><span class="pre">/dev/momobase</span></code> should be found.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ls /dev/momobase
</pre></div>
</div>
</section>
</section>
<section id="flashing-the-firmware">
<h3>Flashing the firmware<a class="headerlink" href="#flashing-the-firmware" title="Permalink to this headline">¶</a></h3>
<p>(Or uploading the code)</p>
<p>To flash the teensy firmware, <cite>platformio</cite> would be used. To do so, simply run
<code class="docutils literal notranslate"><span class="pre">platformio</span> <span class="pre">run</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> momobot/momobot_ws/src/momobot/teensy/firmware
$ platformio run --target upload
</pre></div>
</div>
<ul class="simple">
<li><p>When platformio is ran for the first time, it would download the relevant
manager/tools for the Teensy.</p></li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Facing issues? Check out the troubleshooting section below!</p>
</div>
</section>
</section>
<section id="setting-up-momobot">
<h2>3.2 Setting Up MOMObot<a class="headerlink" href="#setting-up-momobot" title="Permalink to this headline">¶</a></h2>
<section id="logging-into-momobot">
<h3>Logging into MOMObot<a class="headerlink" href="#logging-into-momobot" title="Permalink to this headline">¶</a></h3>
<p>These settings are for our internal use only. You might have to change it around to whatever WiFi network credentials and addresses your own implementation of the MOMObot stack will use.</p>
<ol class="arabic">
<li><p>Login to MOMObot, we use the <cite>SUTD_LAB</cite> WiFi network, with these credentials</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh &lt;USERNAME&gt;@10.21.132.80
</pre></div>
</div>
<p>Or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh momobot
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note, this only works if you’ve configured an SSH Alias for MOMObot!</p>
<p>To do so, put this inside <cite>~/.ssh/config</cite> (Make the file if it doesn’t exist using <cite>sudo touch ~/.ssh/config</cite> or <cite>sudo nano ~/.ssh/config</cite>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">momobot</span>
   <span class="c1"># SUTD_LAB</span>
   <span class="n">Port</span> <span class="mi">22</span>
   <span class="n">User</span> <span class="o">&lt;</span><span class="n">USERNAME</span><span class="o">&gt;</span>
   <span class="n">HostName</span> <span class="mf">10.21</span><span class="o">.</span><span class="mf">132.80</span>
</pre></div>
</div>
</div>
</li>
<li><dl class="simple">
<dt>Access the teensy config file</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roscd</span> <span class="pre">momobot/teensy/firmware/lib/config</span></code></p></li>
<li><p>Opening this file will expose the PID values for tuning</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</section>
<section id="setting-static-ip-for-new-robots">
<h3>Setting Static IP for New Robots<a class="headerlink" href="#setting-static-ip-for-new-robots" title="Permalink to this headline">¶</a></h3>
<p>A static IP is needed so as to be able to ssh into the robot</p>
<ol class="arabic">
<li><p>Setup static IP</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ route -n <span class="c1"># Use this to check default gateway and netmask</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Netmask is the Genmask</p></li>
<li><p>Gateway is Gateway</p></li>
</ul>
<p>Also check if you need a DNS setup. (SUTD requires this one: 192.168.2.100)</p>
</li>
<li><p>Then enable ssh</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install openssh-server
</pre></div>
</div>
</li>
</ol>
<p>To set Static IP, under WiFi connection settings, click edit connections.
Set IPV4, set manual, set static address, Netmask and Gateway, according to <cite>route -n</cite> in the commandline</p>
<p>To work with SUTD wifi for internet, use DNS Server: <cite>192.168.2.100</cite></p>
</section>
<section id="install-ros-and-other-packages-if-needed">
<h3>Install ROS and Other Packages if needed<a class="headerlink" href="#install-ros-and-other-packages-if-needed" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Run the install scripts from setup_scripts</dt><dd><ul class="simple">
<li><p>Credits: <a class="reference external" href="https://github.com/methyldragon/quick-install-scripts">https://github.com/methyldragon/quick-install-scripts</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Specific order:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">./convenience_tools_install</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./ros_lino_base_install</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./robot_playground_install</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ol>
<blockquote>
<div><p>This should install your net tools, ROS, as well as the pre-requisite Linorobot stack.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Then, copy paste the scripts in the <cite>src</cite> directory inside a ROS workspace, preferably called <code class="docutils literal notranslate"><span class="pre">momobot_ws</span></code></p></li>
</ol>
</section>
<section id="setup-the-bashrc-on-momobot-as-well-as-your-computer">
<h3>Setup the <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> on MOMOBot as well as your Computer<a class="headerlink" href="#setup-the-bashrc-on-momobot-as-well-as-your-computer" title="Permalink to this headline">¶</a></h3>
<p>(Otherwise you won’t be able to get any ROS data!!!)</p>
<section id="on-momobot">
<h4>On MOMObot<a class="headerlink" href="#on-momobot" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>Open up the your prefered shell config in a text editor</p></li>
</ol>
<p><strong>Bash (Default)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo nano ~/.bashrc
</pre></div>
</div>
<p><strong>zsh</strong></p>
<div class="highlight-zsh notranslate"><div class="highlight"><pre><span></span>$ sudo nano ~/.zshrc
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Append the following in the shell configuration file:</p></li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>PLEASE REMEMBER TO CHANGE THE THINGS IN &lt;&gt; &amp; Remember to save also!</strong></p>
</div>
<p><strong>Bash (Default)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>...

<span class="nb">source</span> /opt/ros/melodic/setup.bash
<span class="nb">source</span> ~/catkin_ws/devel/setup.bash

<span class="nb">source</span> /home/&lt;USERNAME&gt;/&lt;ROS_WORKSPACE_NAME&gt;/devel/setup.bash

<span class="nb">source</span> ~/&lt;ROS_WORKSPACE_NAME&gt;/devel/setup.bash
<span class="nb">export</span> <span class="nv">LINOLIDAR</span><span class="o">=</span>lms111
<span class="nb">export</span> <span class="nv">LINOBASE</span><span class="o">=</span>2wd

<span class="nb">export</span> <span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:/home/&lt;USERNAME&gt;/&lt;ROS_WORKSPACE_NAME&gt;/src

<span class="nb">alias</span> <span class="nv">costmap_reset</span><span class="o">=</span><span class="s2">"rosservice call /move_base/clear_costmaps"</span>

<span class="nb">export</span> <span class="nv">ROS_IP</span><span class="o">=</span>&lt;IP ADDRESS OF ROBOT&gt;
<span class="nb">export</span> <span class="nv">ROS_HOSTNAME</span><span class="o">=</span>&lt;IP ADDRESS OF ROBOT&gt;
</pre></div>
</div>
<p><strong>zsh</strong></p>
<div class="highlight-zsh notranslate"><div class="highlight"><pre><span></span>...

<span class="nb">source</span> /opt/ros/melodic/setup.zsh
<span class="nb">source</span> ~/catkin_ws/devel/setup.zsh

<span class="nb">source</span> /home/&lt;USERNAME&gt;/&lt;ROS_WORKSPACE_NAME&gt;/devel/setup.zsh

<span class="nb">source</span> ~/&lt;ROS_WORKSPACE_NAME&gt;/devel/setup.zsh
<span class="nb">export</span> <span class="nv">LINOLIDAR</span><span class="o">=</span>lms111
<span class="nb">export</span> <span class="nv">LINOBASE</span><span class="o">=</span>2wd

<span class="nb">export</span> <span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:/home/&lt;USERNAME&gt;/&lt;ROS_WORKSPACE_NAME&gt;/src

<span class="nb">alias</span> <span class="nv">costmap_reset</span><span class="o">=</span><span class="s2">"rosservice call /move_base/clear_costmaps"</span>

<span class="nb">export</span> <span class="nv">ROS_IP</span><span class="o">=</span>&lt;IP ADDRESS OF ROBOT&gt;
<span class="nb">export</span> <span class="nv">ROS_HOSTNAME</span><span class="o">=</span>&lt;IP ADDRESS OF ROBOT&gt;
</pre></div>
</div>
</section>
<section id="on-computer">
<h4>On Computer<a class="headerlink" href="#on-computer" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">~/.bashrc</span></code></p></li>
<li><p>Append this</p>
<blockquote>
<div><ul class="simple">
<li><p>PLEASE REMEMBER TO CHANGE THE THINGS IN &lt;&gt;</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ip</span><span class="o">=</span><span class="k">$(</span>ip addr show wlo1 <span class="p">|</span> grep -o <span class="s1">'inet [0-9]\+\.[0-9]\+\.[0-9]\+\.[0-9]\+'</span> <span class="p">|</span> grep -o <span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>.*<span class="k">)</span>

<span class="nb">export</span> <span class="nv">ROS_MASTER_URI</span><span class="o">=</span>http://&lt;ROBOT_IP_ADDRESS&gt;:11311
<span class="nb">export</span> <span class="nv">ROS_IP</span><span class="o">=</span><span class="nv">$ip</span>
<span class="nb">export</span> <span class="nv">ROS_HOSTNAME</span><span class="o">=</span><span class="nv">$ip</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="running-momobot-capabilities">
<h2>3.3 Running MOMObot Capabilities<a class="headerlink" href="#running-momobot-capabilities" title="Permalink to this headline">¶</a></h2>
<p>This section assumes knowledge of ROS and basic Linorobot packages.
This is because MOMObot is based heavily on the Linorobot stack.</p>
<section id="startup-and-bringup-process">
<h3>Startup and Bringup Process<a class="headerlink" href="#startup-and-bringup-process" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><dl class="simple">
<dt>Ensure that all electronics are connected and turned on</dt><dd><ul class="simple">
<li><p>Ensure that the electronics battery has sufficient charge or the LIDAR will fail to function</p></li>
<li><p>Check to ensure that the LIDAR ethernet cable is connected properly or LIDAR data will not be parsed to the MOMObot stack</p></li>
<li><p>Disengage the E-stop</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>SSH into Momobot: <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">&lt;USERNAME&gt;@10.21.132.80</span></code></p></li>
<li><p>Begin running commands, make sure they’re in individual terminals!</p>
<blockquote>
<div><ul class="simple">
<li><p>When a command says <strong>MOMOBOT</strong>, do it in a terminal that is SSHed into MOMObot, or from the MOMObot computer directly</p></li>
<li><p>When the command says <strong>COMPUTER</strong>, do it on a ground station computer</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>MOMOBOT:</strong> Start ROSCORE before anything else (in it’s own terminal on the MOMObot computer / SSH terminal): <code class="docutils literal notranslate"><span class="pre">roscore</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>It is helpful to run <cite>roscore</cite> FIRST, so if the rest of the roslaunch-es die, you can kill and restart them easily without killing the ROS Master</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>MOMOBOT:</strong> Bringup the MOMObot base controller: <cite>roslaunch momobot bringup.launch</cite></p>
<blockquote>
<div><ul class="simple">
<li><p>Ensure that the robot is not moving during this process as the IMU will be calibrating during bringup.launch. IMU drift will be present if the robot is in motion during this process</p></li>
<li><p>Encoder ticks will be visible in this terminal window. This can be a clear indication that the motor hall sensors are being detected and can also be used for the purposes of PID tuning</p></li>
</ul>
</div></blockquote>
</li>
<li><dl class="simple">
<dt><strong>COMPUTER:</strong> Start the tele operation package in it’s own terminal (preferably on the ground station computer, not MOMObot):</dt><dd><p><code class="docutils literal notranslate"><span class="pre">rosrun</span> <span class="pre">teleop_twist_keyboard</span> <span class="pre">teleop_twist_keyboard</span></code>
- This will enable tele-operation functionality on MOMObot (follow the screen for instructions)</p>
</dd>
</dl>
</li>
</ol>
</section>
<section id="checking-momo-functionality">
<h3>Checking MOMO Functionality<a class="headerlink" href="#checking-momo-functionality" title="Permalink to this headline">¶</a></h3>
<p>This of course requires that you have MOMObot brought up already.</p>
<ol class="arabic">
<li><p><strong>COMPUTER</strong> - Open rviz:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roscd</span> <span class="pre">linorobot/rviz/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rviz</span> <span class="pre">-d</span> <span class="pre">odometry.rviz</span></code></p></li>
<li><p>Under the topic tab on the left menu, it is possible to change the topic between <code class="docutils literal notranslate"><span class="pre">/odom</span></code> and <code class="docutils literal notranslate"><span class="pre">/raw_odom</span></code>.</p></li>
<li><p>It is also possible to add an additional topic and then set the keep to a larger number (e.g 10000) so as to allow for easier visualization</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="ros-graph-debugging-refresher">
<h3>ROS Graph Debugging Refresher<a class="headerlink" href="#ros-graph-debugging-refresher" title="Permalink to this headline">¶</a></h3>
<dl>
<dt>If visualization of all ROS nodes is required for debugging purposes, run</dt><dd><blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">rosrun</span> <span class="pre">rqt_graph</span> <span class="pre">rqt_graph</span></code>
- This will bringup the rqt graph that visualizes all ROS relations and nodes, allowing for easy debugging.</p>
</div></blockquote>
<img alt="rqt_graph" src="../_images/sw_rqt_graph.png"/>
</dd>
</dl>
<p>(ROS nodes as seen in RQT Graph)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/scan</span></code>: laser data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/laser_filter</span></code>: custom node for filtering laser data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/rosserial_lino</span></code>: adapter for connecting to teensy</p>
<blockquote>
<div><ul class="simple">
<li><p>It obtains <code class="docutils literal notranslate"><span class="pre">raw_vel</span></code> which is then sent to the <code class="docutils literal notranslate"><span class="pre">momo_base_node</span></code></p></li>
<li><p>This information is then sent to <code class="docutils literal notranslate"><span class="pre">/raw_odom</span></code> for odometry estimations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/raw_odom</span></code> information will be sent to <code class="docutils literal notranslate"><span class="pre">/ekf_localization</span></code> to be used for Extended Kalman Filtering estimation of the Robot’s location</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/imu/data</span></code>: the raw data from IMU</p>
<blockquote>
<div><ul class="simple">
<li><p>It is also fed into``/ekf_localization``</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>After these commands are ran the following features on Momobot are enabled:</p>
<ol class="arabic simple">
<li><p>Teleop, motors</p></li>
<li><p>Laser data</p></li>
<li><p>Encoder and IMU</p></li>
<li><p>Odometry testing</p></li>
</ol>
</section>
<section id="running-the-navigation-stack">
<h3>Running the Navigation stack<a class="headerlink" href="#running-the-navigation-stack" title="Permalink to this headline">¶</a></h3>
<p>Just like the Linorobot!</p>
<ul>
<li><p>Run this command: <code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">momobot</span> <span class="pre">navigate.launch</span></code></p>
<img alt="rqt_graph" src="../_images/sw_rqt_graph2.png"/>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AMCL</span></code> is the localisation node that corrects sensor drift using the laser and scanmap</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">map_server</span></code> publishes the map</p></li>
</ul>
</li>
</ul>
<p>Autonomous localization and Navigation capabilities enabled and we can tell MOMObot to move by using Rviz or by the using command line:</p>
<ol class="arabic">
<li><p>Publishing directly to topics</p>
<ul>
<li><p>Publish goal messages to these topics to get MOMObot to navigate to the coordinate:</p>
<p><code class="docutils literal notranslate"><span class="pre">/move_base/goal</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/move_base_simple/goal</span></code></p>
</li>
</ul>
</li>
<li><p>Or you can use RViz which is the easiest</p>
<ul>
<li><p>Just use the RViz interface!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ roscd momobot/rviz
$ rviz -d navigate.rviz
</pre></div>
</div>
<p>You might have to change some frame IDs and subscribed topics around, but it should work!</p>
</li>
<li><p>Get your data by subscribing to those topics above using <code class="docutils literal notranslate"><span class="pre">rostopic</span> <span class="pre">echo</span> <span class="pre">&lt;TOPIC_NAME&gt;`</span></code></p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="tuning-momobot">
<h2>3.4 Tuning MOMObot<a class="headerlink" href="#tuning-momobot" title="Permalink to this headline">¶</a></h2>
<section id="changing-the-map">
<h3>Changing The Map<a class="headerlink" href="#changing-the-map" title="Permalink to this headline">¶</a></h3>
<p>If you happen to have a new map that you want MOMObot to use, simply add the map and its corresponding <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> to the <code class="docutils literal notranslate"><span class="pre">momobot/maps</span></code> directory.</p>
<p>Then, point the <code class="docutils literal notranslate"><span class="pre">map_server</span></code> node to the proper map by editing the <code class="docutils literal notranslate"><span class="pre">navigate.launch</span></code> file!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roscd momobot/launch
nano navigate.launch
</pre></div>
</div>
<p>You’ll want to replace this line, changing the  map_file argument!</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"map_file"</span> <span class="na">default=</span><span class="s">"$(find momobot)/maps/&lt;YOUR_MAP_NAME_HERE&gt;.yaml"</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section>
<section id="ekf-tuning">
<h3>EKF Tuning<a class="headerlink" href="#ekf-tuning" title="Permalink to this headline">¶</a></h3>
<section id="method">
<h4>Method<a class="headerlink" href="#method" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Mark out a square of 3m x 3m using tape</p></li>
<li><p>Using tele-operation, drive the robot in a square</p></li>
<li><dl class="simple">
<dt>on <strong>Computer</strong> in the same terminal</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roscd/linorobot/rviz/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rviz</span> <span class="pre">-d</span> <span class="pre">odometry.rviz</span></code></p></li>
<li><p>This can be used to view the distance the robot has think it has travelled</p></li>
<li><dl class="simple">
<dt>In Rviz</dt><dd><ol class="arabic simple">
<li><p>Click on Odometry in the left topic pane (it is possible to select /odom and /raw_odom)</p></li>
<li><p>It is recommended to add another topic and indicator for /raw_odom separately to visualize it alongside the filtered odometry</p></li>
<li><p>Change the shaft length, radius and etc as necessary (set the color to 0, 255, 0 to ensure that the arrows are distinguishable from /odom arrows)</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p>Now you can edit the <code class="docutils literal notranslate"><span class="pre">robot_localization.yaml</span></code> EKF parameters!</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roscd momobot/param/ekf
nano robot_localization.yaml
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="tuning-navigation-parameters">
<h4>Tuning Navigation Parameters<a class="headerlink" href="#tuning-navigation-parameters" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roscd</span> <span class="pre">momobot</span></code> to cd into the momobot stack</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">roscd</span> <span class="pre">momobot/param/</span></code> change these files for navigation parameters</p></li>
</ul>
</section>
<section id="tuning-localization-parameters">
<h4>Tuning Localization Parameters<a class="headerlink" href="#tuning-localization-parameters" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roscd</span> <span class="pre">momobot/launch/include</span></code>, then <code class="docutils literal notranslate"><span class="pre">nano</span> <span class="pre">amcl.launch</span></code></p></li>
<li><p>Parameters of interest:
- laser_max_range
- min_particles
- max_particles
- odom_alpha1 (Rotation noise from rotation)
- odom_alpha2 (Rotation noise from translation)
- odom_alpha3 (Translation noise from translation)
- odom_alpha4 (Translation noise from rotation)</p></li>
</ul>
</section>
</section>
</section>
<section id="console-commands">
<h2>3.5 Console Commands<a class="headerlink" href="#console-commands" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each command is in each individual terminal, opened INSIDE MOMOBOT (i.e. in a terminal that is SSHed into MOMOBOT)</p>
</div>
<section id="set-pose">
<h3>Set Pose<a class="headerlink" href="#set-pose" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> resetting pose... <span class="o">&amp;&amp;</span> rostopic pub /initialpose geometry_msgs/PoseWithCovarianceStamped <span class="s1">'{header: {frame_id: "map"}, pose: {pose: {position: {x: 76.401, y: -15.676, z: 0.0}, orientation: {x: 0.0, y: 0.0, z: -0.10356, w: 0.99462}}, covariance: [0.25, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.25, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.06853891945200942]}}'</span> --once <span class="o">&amp;&amp;</span> <span class="nb">echo</span> clearing costmaps... <span class="o">&amp;&amp;</span> rosservice call /move_base/clear_costmaps <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="k">done</span>!
</pre></div>
</div>
</section>
<section id="set-goal-pose-for-autonomous-navigation">
<h3>Set Goal Pose for Autonomous Navigation<a class="headerlink" href="#set-goal-pose-for-autonomous-navigation" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rostopic pub /move_base_simple/goal geometry_msgs/PoseStamped <span class="s1">'{header: {frame_id: "map"}, pose: {position: {x: 1.93851232529, y: -0.423947900534, z: 0.0}, orientation: {x: 0.0, y: 0.0, z: -0.125194964757, w: 0.992132158938}}}'</span> --once <span class="o">&amp;&amp;</span> rosservice call /move_base/clear_costmaps
</pre></div>
</div>
<p><strong>Computer</strong> load up rviz map again on your costmap
<cite>roscd/linorobot/rviz/</cite>
<cite>rviz -d odometry.rviz</cite></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Important to clear costmaps frequently as there will be phantom obstacles created the longer MOMO is in operation.</p>
</div>
</section>
</section>
<section id="mapping">
<h2>3.6 Mapping<a class="headerlink" href="#mapping" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">momobot</span> <span class="pre">slam.launch</span></code> on <strong>COMPUTER</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rosrun</span> <span class="pre">map_server</span> <span class="pre">map_saver</span></code> to save the map in the current directory. This saves your map files into .yaml files and .pgm files. .pgm can be editted in photoshop, etc like a .png file.</p></li>
<li><p>If you need to change the map name, do it in the <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> file.</p></li>
</ul>
<section id="setting-your-maps">
<h3>Setting your maps<a class="headerlink" href="#setting-your-maps" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Under <code class="docutils literal notranslate"><span class="pre">roscd</span> <span class="pre">momobot</span></code>, name the map properly as the <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> files will be used to load map files here.</p></li>
</ul>
</section>
</section>
<section id="exporting-display-to-momobot-from-computer">
<h2>3.7 Exporting Display to MOMObot from Computer<a class="headerlink" href="#exporting-display-to-momobot-from-computer" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">DISPLAY:0</span></code> enables you to run commands on other computer instead of your computer. Ensure that you are on the right terminal <strong>MOMOBOT</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rosrun</span> <span class="pre">momo_emotions</span> <span class="pre">cmd_vel_face_tracking.py</span></code> to run face cmd_vel tracking script on <strong>MOMObot</strong> from the <strong>Computer Terminal</strong></p></li>
<li><p>This allows the script to be started during events or situations where it may be difficult to access the on-board computer</p></li>
</ul>
</section>
<section id="semantic-pose-and-semantic-pose-sounder-packages">
<h2>3.8 Semantic Pose and Semantic Pose Sounder Packages<a class="headerlink" href="#semantic-pose-and-semantic-pose-sounder-packages" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">semantic_pose</span></code> package allows the robot to map robot coordinates to
named locations. You can use this alongside <code class="docutils literal notranslate"><span class="pre">semantic_pose_sounder</span></code> to
<strong>let MOMObot play voice lines upon entering a particular named location!</strong></p>
</div>
<ul>
<li><p>Must be on <strong>MOMOBOT</strong>: <code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">semantic_pose_sounder</span> <span class="pre">semantic_pose_sound.launch</span></code></p></li>
<li><p>This loads all the ros parameters required.</p></li>
<li><p>Edit them in the associated <cite>config.yaml</cite> in the package (Check it out with <code class="docutils literal notranslate"><span class="pre">roscd</span> <span class="pre">semantic_pose_sounder</span></code>)</p></li>
<li><p>The location parameters are set in the following format: <code class="docutils literal notranslate"><span class="pre">'location:</span> <span class="pre">[boundingpt1,</span> <span class="pre">boundingpt2,</span> <span class="pre">boundingpt3...]'</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>Set as many bounding points as necessary but <strong>ensure that they are in clockwise or anti-clockwise direction</strong></p></li>
<li><p>Bounding points define the boundary for a location (robot will be considered in that location if it is within the boundary)</p></li>
<li><p>Get bounding points from the map by running navigate.launch. The coordinates for various points on the map can be read easily</p></li>
<li><p>You can then define their names, which will be the strings published to <cite>/location</cite> when the robot is localised within those map zones</p></li>
<li><p>You can also define the corresponding MP3s to play!</p></li>
</ul>
</div></blockquote>
</li>
<li><p>To check MOMObot’s current location: <code class="docutils literal notranslate"><span class="pre">rostopic</span> <span class="pre">echo</span> <span class="pre">location</span></code></p></li>
</ul>
</section>
<section id="software-to-dos">
<h2>3.9 Software To-Dos<a class="headerlink" href="#software-to-dos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Laser scan matcher</p></li>
<li><p>Visual odometry</p></li>
<li><p>Depth camera integration</p></li>
<li><dl class="simple">
<dt>Rear LiDAR integration (Need to combine the <code class="docutils literal notranslate"><span class="pre">/scans</span></code> somehow)</dt><dd><ul>
<li><p>Once that’s done we can swap to the DWA planner to allow MOMObot to reverse!</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="troubleshooting">
<h2>3.10 Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<section id="libusb-0-1-so-4-not-found-platformio-issue">
<h3>libusb-0.1.so.4 not found (platformio issue)<a class="headerlink" href="#libusb-0-1-so-4-not-found-platformio-issue" title="Permalink to this headline">¶</a></h3>
<p>If you encounter the following issue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">teensy_loader_cli</span><span class="p">:</span> <span class="n">error</span> <span class="k">while</span> <span class="n">loading</span> <span class="n">shared</span> <span class="n">libraries</span><span class="p">:</span> <span class="n">libusb</span><span class="o">-</span><span class="mf">0.1</span><span class="o">.</span><span class="n">so</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="n">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
<span class="o">***</span> <span class="p">[</span><span class="n">upload</span><span class="p">]</span> <span class="n">Error</span> <span class="mi">127</span>
</pre></div>
</div>
<p>It could fix be downloading the required library through <code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">install</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install libusb-0.1-4
</pre></div>
</div>
</section>
<section id="sdl-issue">
<h3>SDL Issue<a class="headerlink" href="#sdl-issue" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">CRITICAL</span><span class="p">]</span> <span class="p">[</span><span class="n">Window</span>      <span class="p">]</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">find</span> <span class="nb">any</span> <span class="n">valuable</span> <span class="n">Window</span> <span class="n">provider</span><span class="o">.</span> <span class="n">Please</span> <span class="n">enable</span> <span class="n">debug</span> <span class="n">logging</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">add</span> <span class="o">-</span><span class="n">d</span> <span class="k">if</span> <span class="n">running</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">command</span> <span class="n">line</span><span class="p">,</span> <span class="ow">or</span> <span class="n">change</span> <span class="n">the</span> <span class="n">log</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">config</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">-</span><span class="n">run</span> <span class="n">your</span> <span class="n">app</span> <span class="n">to</span> <span class="n">identify</span> <span class="n">potential</span> <span class="n">causes</span>
<span class="n">egl_rpi</span> <span class="o">-</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="n">cannot</span> <span class="kn">import</span> <span class="nn">name</span> <span class="s1">'bcm'</span>
  <span class="n">File</span> <span class="s2">"/usr/lib/python3/dist-packages/kivy/core/__init__.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">63</span><span class="p">,</span> <span class="ow">in</span> <span class="n">core_select_lib</span>
    <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">modulename</span><span class="p">],</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">"/usr/lib/python3/dist-packages/kivy/core/window/window_egl_rpi.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">12</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">from</span> <span class="nn">kivy.lib.vidcore_lite</span> <span class="k">import</span> <span class="n">bcm</span><span class="p">,</span> <span class="n">egl</span>

<span class="n">sdl2</span> <span class="o">-</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="n">libSDL2_image</span><span class="o">-</span><span class="mf">2.0</span><span class="o">.</span><span class="n">so</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="n">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
  <span class="n">File</span> <span class="s2">"/usr/lib/python3/dist-packages/kivy/core/__init__.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">63</span><span class="p">,</span> <span class="ow">in</span> <span class="n">core_select_lib</span>
    <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">modulename</span><span class="p">],</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">"/usr/lib/python3/dist-packages/kivy/core/window/window_sdl2.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">27</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">from</span> <span class="nn">kivy.core.window._window_sdl2</span> <span class="k">import</span> <span class="n">_WindowSDL2Storage</span>

<span class="n">x11</span> <span class="o">-</span> <span class="n">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">'kivy.core.window.window_x11'</span>
  <span class="n">File</span> <span class="s2">"/usr/lib/python3/dist-packages/kivy/core/__init__.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">63</span><span class="p">,</span> <span class="ow">in</span> <span class="n">core_select_lib</span>
    <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">modulename</span><span class="p">],</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="p">[</span><span class="n">CRITICAL</span><span class="p">]</span> <span class="p">[</span><span class="n">App</span>         <span class="p">]</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">Window</span><span class="p">,</span> <span class="n">abort</span><span class="o">.</span>
</pre></div>
</div>
<p>The following issue is caused by a missing sdl2 library, could be resolved by installing the python3-sdl2 package.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt install python3-sdl2
</pre></div>
</div>
</section>
<section id="d-bus-issue-jetson-tx2">
<h3>D-Bus Issue (Jetson TX2)<a class="headerlink" href="#d-bus-issue-jetson-tx2" title="Permalink to this headline">¶</a></h3>
<p>If there are issues running programs that utillises the kivy lib as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">INFO</span>   <span class="p">]</span> <span class="p">[</span><span class="n">Window</span>      <span class="p">]</span> <span class="n">Provider</span><span class="p">:</span> <span class="n">sdl2</span><span class="p">([</span><span class="s1">'window_egl_rpi'</span><span class="p">]</span> <span class="n">ignored</span><span class="p">)</span>
<span class="n">dbus</span><span class="p">[</span><span class="mi">24434</span><span class="p">]:</span> <span class="n">arguments</span> <span class="n">to</span> <span class="n">dbus_message_new_method_call</span><span class="p">()</span> <span class="n">were</span> <span class="n">incorrect</span><span class="p">,</span> <span class="n">assertion</span> <span class="s2">"path != NULL"</span> <span class="n">failed</span> <span class="ow">in</span> <span class="n">file</span> <span class="o">../../../</span><span class="n">dbus</span><span class="o">/</span><span class="n">dbus</span><span class="o">-</span><span class="n">message</span><span class="o">.</span><span class="n">c</span> <span class="n">line</span> <span class="mf">1362.</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">normally</span> <span class="n">a</span> <span class="n">bug</span> <span class="ow">in</span> <span class="n">some</span> <span class="n">application</span> <span class="n">using</span> <span class="n">the</span> <span class="n">D</span><span class="o">-</span><span class="n">Bus</span> <span class="n">library</span><span class="o">.</span>

  <span class="n">D</span><span class="o">-</span><span class="n">Bus</span> <span class="ow">not</span> <span class="n">built</span> <span class="k">with</span> <span class="o">-</span><span class="n">rdynamic</span> <span class="n">so</span> <span class="n">unable</span> <span class="n">to</span> <span class="nb">print</span> <span class="n">a</span> <span class="n">backtrace</span>
<span class="n">Aborted</span> <span class="p">(</span><span class="n">core</span> <span class="n">dumped</span><span class="p">)</span>
</pre></div>
</div>
<p>Add <code class="docutils literal notranslate"><span class="pre">DBUS_FATAL_WARNINGS=0</span></code> before the program name: (<a class="reference external" href="https://bugs.launchpad.net/ubuntu/+source/libsdl2/+bug/1775067">Reference</a>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DBUS_FATAL_WARNINGS</span><span class="o">=</span><span class="mi">0</span> <span class="p">{</span><span class="n">python_script</span><span class="p">}</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">python_script</span></code> with the program name.</p>
</section>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../bonus/vesc_doc.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Flipsky VESC 4.12 Documentation</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="electronics.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Electronics</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021 SUTD Organisation of Autonomous Robotics
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../_sources/com/software.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Software</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#pre-requisites">3.1 Pre-Requisites</a><ul>
<li><a class="reference internal" href="#platformio">platformio</a></li>
<li><a class="reference internal" href="#pygame">pygame</a></li>
<li><a class="reference internal" href="#ros-packages">ROS Packages</a></li>
<li><a class="reference internal" href="#teensy">Teensy</a><ul>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flashing-the-firmware">Flashing the firmware</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-up-momobot">3.2 Setting Up MOMObot</a><ul>
<li><a class="reference internal" href="#logging-into-momobot">Logging into MOMObot</a></li>
<li><a class="reference internal" href="#setting-static-ip-for-new-robots">Setting Static IP for New Robots</a></li>
<li><a class="reference internal" href="#install-ros-and-other-packages-if-needed">Install ROS and Other Packages if needed</a></li>
<li><a class="reference internal" href="#setup-the-bashrc-on-momobot-as-well-as-your-computer">Setup the <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> on MOMOBot as well as your Computer</a><ul>
<li><a class="reference internal" href="#on-momobot">On MOMObot</a></li>
<li><a class="reference internal" href="#on-computer">On Computer</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#running-momobot-capabilities">3.3 Running MOMObot Capabilities</a><ul>
<li><a class="reference internal" href="#startup-and-bringup-process">Startup and Bringup Process</a></li>
<li><a class="reference internal" href="#checking-momo-functionality">Checking MOMO Functionality</a></li>
<li><a class="reference internal" href="#ros-graph-debugging-refresher">ROS Graph Debugging Refresher</a></li>
<li><a class="reference internal" href="#running-the-navigation-stack">Running the Navigation stack</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tuning-momobot">3.4 Tuning MOMObot</a><ul>
<li><a class="reference internal" href="#changing-the-map">Changing The Map</a></li>
<li><a class="reference internal" href="#ekf-tuning">EKF Tuning</a><ul>
<li><a class="reference internal" href="#method">Method</a></li>
<li><a class="reference internal" href="#tuning-navigation-parameters">Tuning Navigation Parameters</a></li>
<li><a class="reference internal" href="#tuning-localization-parameters">Tuning Localization Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#console-commands">3.5 Console Commands</a><ul>
<li><a class="reference internal" href="#set-pose">Set Pose</a></li>
<li><a class="reference internal" href="#set-goal-pose-for-autonomous-navigation">Set Goal Pose for Autonomous Navigation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mapping">3.6 Mapping</a><ul>
<li><a class="reference internal" href="#setting-your-maps">Setting your maps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exporting-display-to-momobot-from-computer">3.7 Exporting Display to MOMObot from Computer</a></li>
<li><a class="reference internal" href="#semantic-pose-and-semantic-pose-sounder-packages">3.8 Semantic Pose and Semantic Pose Sounder Packages</a></li>
<li><a class="reference internal" href="#software-to-dos">3.9 Software To-Dos</a></li>
<li><a class="reference internal" href="#troubleshooting">3.10 Troubleshooting</a><ul>
<li><a class="reference internal" href="#libusb-0-1-so-4-not-found-platformio-issue">libusb-0.1.so.4 not found (platformio issue)</a></li>
<li><a class="reference internal" href="#sdl-issue">SDL Issue</a></li>
<li><a class="reference internal" href="#d-bus-issue-jetson-tx2">D-Bus Issue (Jetson TX2)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/main.js"></script>
    </body>
</html>