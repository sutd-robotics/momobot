<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Software" href="software.html" /><link rel="prev" title="Hardware" href="hardware.html" />

    <meta name="generator" content="sphinx-4.0.3, furo 2021.07.05.beta38"/>
        <title>Electronics - momobot 1.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css" />
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">momobot 1.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/MOMO_logo_full.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">momobot 1.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hardware.html">Hardware</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Electronics</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software</a></li>
</ul>
<p class="caption"><span class="caption-text">Extra</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bonus/vesc_doc.html">Flipsky VESC 4.12 Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bonus/cd_links.html">Circuit Diagram Draw.io Links</a></li>
</ul>
<p class="caption"><span class="caption-text">Credits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../credits/contributions.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits/license.html">License</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <section id="electronics">
<h1>Electronics<a class="headerlink" href="#electronics" title="Permalink to this headline">¶</a></h1>
<p>It powers the controlling system, including the lidar, VESC, Teensy, laptop , router as well as two solid state relays
Two solid state relays were used.</p>
<section id="electronic-bom">
<h2>2.1 Electronic BOM<a class="headerlink" href="#electronic-bom" title="Permalink to this headline">¶</a></h2>
<section id="power-source">
<h3>Power Source<a class="headerlink" href="#power-source" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>2x 12V 55Ah Pb acid batteries (Connected in Series)</p></li>
<li><p>2x 12v 7Ah Pb acid batteries (Connected in Series)</p></li>
<li><p>Terminal Blocks for Power Distribution</p></li>
<li><p>3x el cheapo (Taobao) variable voltage Buck (literally worth the buck) Converter (replace pls) (current settings 2x 19V, 1x 12V)</p></li>
</ul>
</section>
<section id="sensors">
<h3>Sensors<a class="headerlink" href="#sensors" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>1x LMS111 LiDAR</dt><dd><ul>
<li><p>20m range, 270 degree FOV</p></li>
<li><p>For obstacle detection, and mapping, for navigation</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Motor Encoders (Came With Motors)</dt><dd><ul>
<li><p>Measure how far motors have turned, important for odometry</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>GY-85 IMU</dt><dd><ul>
<li><p>Important for Odometry, provides another source</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strike> Marvelmind Indoor GPS </strike> (Currently not in use, for a 3rd possible
global pose data source)</p></li>
</ul>
</section>
<section id="actuators-display-and-outputs">
<h3>Actuators, Display and Outputs<a class="headerlink" href="#actuators-display-and-outputs" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>1x Waveshare 13.3” HDMI LCD (H) with case</dt><dd><ul>
<li><p><a class="reference external" href="https://www.waveshare.com/13.3inch-hdmi-lcd-h-with-case.htm">https://www.waveshare.com/13.3inch-hdmi-lcd-h-with-case.htm</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>2x Flipsky 50A Continuous VESC v4.12 (Using JST-PH)</dt><dd><ul>
<li><p>Normal ESC did not work for our specced motor</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>350W 24V Brushless DC Scooter Hub Motor</dt><dd><ul>
<li><p><a class="reference external" href="https://www.aliexpress.com/item/24V-36V-48V-8Inch-Electric-Wheel-Hub-Motor-350W-Brushless-Non-Gear-Hub-Motor-For-Electric/32837818637.html">https://www.aliexpress.com/item/24V-36V-48V-8Inch-Electric-Wheel-Hub-Motor-350W-Brushless-Non-Gear-Hub-Motor-For-Electric/32837818637.html</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Teensy 3.2 (Original from PJRC)</p></li>
<li><p>Cheap speakers</p></li>
</ul>
</section>
<section id="safety-and-power-control">
<h3>Safety and Power Control<a class="headerlink" href="#safety-and-power-control" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>1x Schnieder DC Circuit Breaker 125V 20A (2-way)</p></li>
<li><p>1x Schnieder DC Circuit Breaker 125V 16A (1-way)</p></li>
<li><p>2x CDG1-1DD/40A Solid State Relay</p></li>
<li><p>1x CDG1-1DD/25A Solid State Relay</p></li>
<li><p>Heat sinks</p></li>
<li><dl class="simple">
<dt>1x A22E-M E-stop</dt><dd><ul>
<li><p>Application: Switch (Option, Others)</p></li>
<li><p>Conforming series: φ22/ 25 switch, indicator light</p></li>
<li><p>Type: Operating unit (non-illuminated type)</p></li>
<li><p>Details of shape: Medium type (φ40)</p></li>
<li><p>Colour: Red</p></li>
<li><p>Protection function: IP65 oil resistant type</p></li>
<li><p>Push button operation: Push to lock/turn to reset</p></li>
<li><p>Light Source Type: Non-Illumination</p></li>
<li><p>Voltage Uses Light Source(V): Non-Illumination</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>3x KR2-11 Rocker Switches (Red and Green)</dt><dd><ul>
<li><p>Type: On/Off, DPST</p></li>
<li><p>Rating: 10A/250VAC</p></li>
<li><p>Mechanical life: 50,000 cycles</p></li>
<li><p>Insulation: 500MΩ</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>1x XK-A6/-Y Enclosure Electronics Box (E-box)</dt><dd><ul>
<li><p>Enclosure types: Enclosure with 6 Ø22.5mm holes</p></li>
<li><p>Shell material:Plastic</p></li>
<li><p>IP grades:IP65</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>1x AD16-22D/S Green LED Pilot Light Panel Indicator</dt><dd><ul>
<li><p>Voltage: 24V</p></li>
<li><p>Rated Current: 20mA</p></li>
<li><p>Material: Plastic, Electric Components</p></li>
<li><p>Thread Diameter: 22mm / 0.87”</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>1x Terminal Block (within the E-box)</p></li>
</ul>
</section>
<section id="connectors">
<h3>Connectors<a class="headerlink" href="#connectors" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>8x XT90 Connectors (Male and Female)</p></li>
<li><p>2x 6mm Barrel Jacks</p></li>
<li><p>Laptop power adapter</p></li>
</ul>
</section>
</section>
<section id="start-up-shut-down-procedure">
<h2>2.2 Start-Up, Shut-Down Procedure<a class="headerlink" href="#start-up-shut-down-procedure" title="Permalink to this headline">¶</a></h2>
<section id="start-up-full">
<h3>Start-Up (FULL)<a class="headerlink" href="#start-up-full" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Check the battery leads and ensure that the batteries are connected in series</p></li>
<li><p>Electronics breakers to be Switched to “ON”</p></li>
<li><p>Set the Green electronics switch to “ON”</p></li>
<li><p>Motor Breakers to be switched to “ON”</p></li>
<li><p>Set the E-stop to “OFF”</p></li>
</ol>
</section>
<section id="shut-down-full">
<h3>Shut-down (FULL)<a class="headerlink" href="#shut-down-full" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Set the E-stop to “ON”</p></li>
<li><p>Switch the Motor breakers to “OFF”</p></li>
<li><p>Set the electronics switch to “OFF”</p></li>
<li><p>Set the electronics breaker to “OFF”</p></li>
<li><p>Disconnect battery leads</p></li>
</ol>
</section>
<section id="start-up-truncated">
<h3>Start-Up (truncated)<a class="headerlink" href="#start-up-truncated" title="Permalink to this headline">¶</a></h3>
<p>This assumes the batteries have been connected beforehand
1. Electronics switch to be set to “ON”
2. E-stop set to “OFF”</p>
</section>
<section id="shut-down-truncated">
<h3>Shut-down (truncated)<a class="headerlink" href="#shut-down-truncated" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>E-stop set to “ON”</p></li>
<li><p>Electronics switch to be set to “OFF”</p></li>
<li><p>Disconnect the battery leads</p></li>
</ol>
</section>
</section>
<section id="gotchas-hacky-stuff-and-things-to-take-note-of">
<h2>2.3 Gotchas, Hacky Stuff and Things to Take Note Of<a class="headerlink" href="#gotchas-hacky-stuff-and-things-to-take-note-of" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>2x16AWG wires used to take high current out of battery, as we did not have thick enough wires at the time. The wire usage was not consistent, as some were salvaged PVC wires from the previous bot. Suggested to use all silicone coated wires with low gauge for higher termperature endurance and lower resistance.</p></li>
<li><p>Encoder and PWM input wires from Teensy to the VESC was connected using jumper cables rather than specific JST-PH connectors. Encoder wires were spliced to 2, one to VESC, one to teensy, causing a mess of wires and potential intermittent connections.</p></li>
<li><p>All bulk converter displayers are broken - they show a wrong voltage.</p></li>
<li><p>VESC can be better positioned to be easier USB tunned, and the layout should be revised for easier switch fliping.</p></li>
<li><p>No voltage monitoring circuit included in either of the two electrical system, making monitoring and preparing for recharge difficult. 19v for fully charged, 18.1v for need to charge. Circuit needed to be implemented to prevent either of the batteries from over-discharging.</p></li>
<li><p>The lack of a charging circuit made the life of the maintenance team difficult. Much more troubles of disconnecting the batteries for recharging and connecting back for operation</p></li>
</ul>
</section>
<section id="circuit-diagrams">
<h2>2.4 Circuit Diagrams<a class="headerlink" href="#circuit-diagrams" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The robot consists of two power systems</p></li>
<li><p>24V with smaller battery capacity and 24V with bigger battery capacity</p></li>
<li><p>Both 2 cells in series to boost the voltage for the motors, as well as the lidar</p></li>
</ul>
<section id="power">
<h3>Power<a class="headerlink" href="#power" title="Permalink to this headline">¶</a></h3>
<img alt="teensy_connections" src="../_images/MOMObot_Power_Diagram.png"/>
<img alt="power_sch" src="../_images/PowerSchematicDiagram.png"/>
<img alt="Battery" src="../_images/momo_batt.png"/>
</section>
<section id="electronics-schematic">
<h3>Electronics Schematic<a class="headerlink" href="#electronics-schematic" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="../_images/momo_elec_teensy.png"><img alt="teensy_connections" src="../_images/momo_elec_teensy.png" style="width: 100%;"/></a>
</section>
</section>
<section id="motor-tuning">
<h2>2.5 Motor Tuning<a class="headerlink" href="#motor-tuning" title="Permalink to this headline">¶</a></h2>
<section id="vesc-tuning">
<h3>VESC tuning<a class="headerlink" href="#vesc-tuning" title="Permalink to this headline">¶</a></h3>
<p>Follow link for VESC tuning documentation
- <a class="reference internal" href="../bonus/vesc_doc.html#vesc-doc-main"><span class="std std-ref">Flipsky VESC 4.12 Documentation</span></a></p>
</section>
<section id="foc-signal">
<h3>FOC signal<a class="headerlink" href="#foc-signal" title="Permalink to this headline">¶</a></h3>
<p>VESC also has internal PID control which is not modified in the original
MOMObot because the PPM signals sent to the motors have been PID-ed in the
ROS stack.</p>
<ul class="simple">
<li><p>When tuning the PPM signal centre, max and min, ensure that the ROS stack is
running.</p></li>
<li><p>The neutral signal will be the “centre”, max forward throttle will be “max”
PPM and max reverse throttle “min” PPM.</p></li>
<li><p>The deadband of 10% is selected to allow MOMO to gain enough throttle to
overcome initial traction.</p></li>
<li><p>A PPM deadband of &lt; 2% is not recommended as it means any small fluctuation
in PPM will command motor response.</p></li>
</ul>
<blockquote>
<div><p>3 days work tuning the settings</p>
</div></blockquote>
<p>Read lots of guides for Duty settings - values that work
After tuning the VESC’s PPM and Duty Cycle settings, remember to write the settings else they will not be saved.</p>
</section>
<section id="momo-charges-alot">
<h3>Momo charges alot<a class="headerlink" href="#momo-charges-alot" title="Permalink to this headline">¶</a></h3>
<p>Possible due to the I component of PID increasing when attempting to Pivot, then when transitioning to a forward movement, the built up I causes a surge in motor response.</p>
</section>
<section id="room-for-improvement">
<h3>Room for improvement<a class="headerlink" href="#room-for-improvement" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>FOC profile can be improved (FOC settings , will have lots of variables to tune to fit the curve better)</p></li>
<li><p>Positive, negative ramping time</p></li>
</ul>
</section>
</section>
<section id="pid-tuning-from-the-momobot-side">
<h2>2.6 PID Tuning from the MOMObot side<a class="headerlink" href="#pid-tuning-from-the-momobot-side" title="Permalink to this headline">¶</a></h2>
<p><strong>Edit the config file</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roscd</span> <span class="pre">momobot/teensy/firmware/lib/config/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nano</span> <span class="pre">momo_base_config.h</span></code></p></li>
<li><p>Change these parameters:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Differential drive</p></li>
<li><p>USE_ESC</p></li>
<li><p>Kp, Ki, Kd</p></li>
<li><p>Encoder pins, can be changed in hardware or code</p></li>
</ul>
</div></blockquote>
<p>Use the Linorobot <a class="reference external" href="https://github.com/linorobot/linorobot/wiki/2.-Base-Controller">PID tuning guide</a>!</p>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="software.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Software</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="hardware.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Hardware</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021 SUTD Organisation of Autonomous Robotics
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../_sources/com/electronics.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Electronics</a><ul>
<li><a class="reference internal" href="#electronic-bom">2.1 Electronic BOM</a><ul>
<li><a class="reference internal" href="#power-source">Power Source</a></li>
<li><a class="reference internal" href="#sensors">Sensors</a></li>
<li><a class="reference internal" href="#actuators-display-and-outputs">Actuators, Display and Outputs</a></li>
<li><a class="reference internal" href="#safety-and-power-control">Safety and Power Control</a></li>
<li><a class="reference internal" href="#connectors">Connectors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#start-up-shut-down-procedure">2.2 Start-Up, Shut-Down Procedure</a><ul>
<li><a class="reference internal" href="#start-up-full">Start-Up (FULL)</a></li>
<li><a class="reference internal" href="#shut-down-full">Shut-down (FULL)</a></li>
<li><a class="reference internal" href="#start-up-truncated">Start-Up (truncated)</a></li>
<li><a class="reference internal" href="#shut-down-truncated">Shut-down (truncated)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gotchas-hacky-stuff-and-things-to-take-note-of">2.3 Gotchas, Hacky Stuff and Things to Take Note Of</a></li>
<li><a class="reference internal" href="#circuit-diagrams">2.4 Circuit Diagrams</a><ul>
<li><a class="reference internal" href="#power">Power</a></li>
<li><a class="reference internal" href="#electronics-schematic">Electronics Schematic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#motor-tuning">2.5 Motor Tuning</a><ul>
<li><a class="reference internal" href="#vesc-tuning">VESC tuning</a></li>
<li><a class="reference internal" href="#foc-signal">FOC signal</a></li>
<li><a class="reference internal" href="#momo-charges-alot">Momo charges alot</a></li>
<li><a class="reference internal" href="#room-for-improvement">Room for improvement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pid-tuning-from-the-momobot-side">2.6 PID Tuning from the MOMObot side</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/main.js"></script>
    </body>
</html>