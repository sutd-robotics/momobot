<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Circuit Diagram Draw.io Links" href="cd_links.html" /><link rel="prev" title="Software" href="../com/software.html" />

    <meta name="generator" content="sphinx-4.0.3, furo 2021.07.05.beta38"/>
        <title>Flipsky VESC 4.12 Documentation - momobot 1.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css" />
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">momobot 1.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/MOMO_logo_full.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">momobot 1.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../com/hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../com/electronics.html">Electronics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../com/software.html">Software</a></li>
</ul>
<p class="caption"><span class="caption-text">Extra</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Flipsky VESC 4.12 Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cd_links.html">Circuit Diagram Draw.io Links</a></li>
</ul>
<p class="caption"><span class="caption-text">Credits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../credits/contributions.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits/license.html">License</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <section id="flipsky-vesc-4-12-documentation">
<span id="vesc-doc-main"></span><h1>Flipsky VESC 4.12 Documentation<a class="headerlink" href="#flipsky-vesc-4-12-documentation" title="Permalink to this headline">¶</a></h1>
<p>[<a class="reference external" href="https://github.com/Fasermaler/Misc-Notes/blob/master/Flipsky%20VESC%204.12%20Documentation.md">Credits</a>]</p>
<p>This is a documentation for how to use and configure the flipSky FSESC 4.12 used
on the MOMObot. The exact store page can be found in this
<a class="reference external" href="https://flipsky.net/products/torque-esc-vesc-%C2%AE-bldc-electronic-speed-controller">link</a>.</p>
<section id="contribution-guidelines">
<h2>Contribution Guidelines<a class="headerlink" href="#contribution-guidelines" title="Permalink to this headline">¶</a></h2>
<p>If you update this guide, kindly send a pull request to the original repo
listed in the credits!</p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Vedder Electronic Speed Controller (VESC) is a highly configurable (largely)
open source ESC that sees a wide variety of applications by hobbyists in the
electric scooter or skateboard domain. This makes VESC a suitable ESC for
MOMObot as it uses scooter motors for movement. VESC is an excellent choice
for hobby robotics of this scale as it is:</p>
<ul class="simple">
<li><p>Highly configurable with both conventional BLDC control as well as FOC support</p></li>
<li><p>Supports a wide variety of motors and configurations</p></li>
<li><p>Self-tuning which allows even unmarked motors from Aliexpress or Taobao to be
calibrated properly</p></li>
<li><p>Generally has an internal BEC, MOSFET and etc which makes it an all in one package</p></li>
<li><p>Able to control motors using PPM, analog, UART, I2C, USB, CAN-bus</p></li>
<li><p>Effective even with sensorless motors</p></li>
<li><p>Small and light for what it can achieve</p></li>
</ul>
</section>
<section id="flipsky-vesc-4-12">
<h2>Flipsky VESC 4.12<a class="headerlink" href="#flipsky-vesc-4-12" title="Permalink to this headline">¶</a></h2>
<p>The Flipsky VESC 4.12 is a surprisingly robust product that does not require a laboratory power supply for first start configuration (contrary to some VESC guides on the internet). Despite being made in China, it offers reliable performance that matches some of the more expensive ESCs on the market. It is also one of the few remaining VESC providers that has remained backward compatible with the open source VESC software (many providers have converted the VESC stack to a more proprietary one).</p>
<section id="firmware">
<h3>Firmware<a class="headerlink" href="#firmware" title="Permalink to this headline">¶</a></h3>
<p>Flipsky VESC 4.12 has a hardware version of 4.12 and a software version of 3.4. This means only specific version of VESC tools can be used with the ESC. Because of the finicky nature of download links on the internet (as well as some requiring registration), I have uploaded the specific VESC tool (windows) proven to work with the Flipsky VESC 4.12 <a class="reference external" href="https://drive.google.com/file/d/1Co-ZkWsYtM6cXchykglwBf2F281r1QB_/view?usp=sharing">here</a>. The exact version is VESC tool version 0.95.</p>
</section>
<section id="specifications">
<h3>Specifications<a class="headerlink" href="#specifications" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Hardware: v4.12</p></li>
<li><p>Firmware: v3.40</p></li>
<li><p>PCB: 4 layers, size: 40*60mm</p></li>
<li><p>Current: 50A continuous / 240A peak</p></li>
<li><p>Voltage: 8V-60V (cells: 3-13S LiPo)</p></li>
<li><p>Recommended: 10S battery</p></li>
<li><p>BEC: <a class="reference external" href="mailto:5V%401.5A">5V<span>@</span>1<span>.</span>5A</a></p></li>
<li><p>BEC type: Internal driver support</p></li>
<li><p>Timing: Software Calibration</p></li>
<li><p>Motor control interface: PPM signal (RC servo), analog, UART, I2C,    USB or CAN‐bus</p></li>
<li><p>Cutoff Voltage: Programmable</p></li>
<li><p>Frequency: PWM Input</p></li>
<li><p>Governor: No</p></li>
<li><p>Weight: 80g</p></li>
<li><p>FSESC4.12 Size: 60x40x20mm</p></li>
<li><p>Programming card: No</p></li>
<li><p>Reverse Direction support: Yes</p></li>
</ul>
</section>
<section id="connections">
<h3>Connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="../_images/06_be544658-0682-45ea-8461-9ecee8e482f2_2048x2048.jpg"><img alt="Connections" src="../_images/06_be544658-0682-45ea-8461-9ecee8e482f2_2048x2048.jpg" style="width: 100%;"/></a>
</section>
</section>
<section id="software-setup">
<h2>Software Setup<a class="headerlink" href="#software-setup" title="Permalink to this headline">¶</a></h2>
<section id="motor-connection-and-setup">
<h3>Motor Connection and Setup<a class="headerlink" href="#motor-connection-and-setup" title="Permalink to this headline">¶</a></h3>
<p>Some information was referenced from the <a class="reference external" href="https://cdn.shopify.com/s/files/1/0011/4039/1996/files/Motor_Setup_Wizard.pdf?11313553160569203029">Motor Wizard Guide</a>.</p>
<ol class="arabic simple">
<li><p>Start <code class="docutils literal notranslate"><span class="pre">vesc_tool_0.95.exe</span></code> in administrator mode</p>
<ul class="simple">
<li><p>VESC Tool will prompt to update, don’t update</p></li>
</ul>
</li>
<li><p>The tool should look like this:</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/1555308556859.png"><img alt="../_images/1555308556859.png" src="../_images/1555308556859.png" style="width: 100%;"/></a>
<ol class="arabic simple" start="3">
<li><p>Plug in the one of the Flipsky VESCs to the computer via mini-USB cable.</p></li>
<li><p>Click on the connection icon in the top right corner.</p>
<ul class="simple">
<li><p>If prompted to update the software of the VESC, proceed to update!</p></li>
</ul>
</li>
</ol>
<a class="reference internal image-reference" href="../_images/1555308548007.png"><img alt="../_images/1555308548007.png" src="../_images/1555308548007.png" style="width: 100%;"/></a>
<ol class="arabic simple" start="5">
<li><p>Alternatively, click on the <code class="docutils literal notranslate"><span class="pre">connection</span></code> tab in the left menu and select <code class="docutils literal notranslate"><span class="pre">Autoconnect</span></code>:</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/1555308539968.png"><img alt="../_images/1555308539968.png" src="../_images/1555308539968.png" style="width: 100%;"/></a>
<ol class="arabic simple" start="6">
<li><p>The VESC should now have a lit green LED. If there isn’t a lit LED, check if the drive has been installed correctly or if the product is defective</p></li>
<li><p>The motor setup wizard should appear, follow the steps accordingly</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/1555308527000.png"><img alt="../_images/1555308527000.png" src="../_images/1555308527000.png" style="width: 100%;"/></a>
<ol class="arabic simple" start="8">
<li><p>In our case, we will be selecting Field Oriented Control (FOC):</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/1555308503717.png"><img alt="../_images/1555308503717.png" src="../_images/1555308503717.png" style="width: 100%;"/></a>
<ol class="arabic" start="9">
<li><p>Under the motor setup wizard, enter the following parameters for the scooter motors used by the MOMObot:</p>
<ul class="simple">
<li><p>Motor Current Max: 20A</p></li>
<li><p>Motor Current Max Brake: -20A</p></li>
<li><p>Battery Current Max: 60A</p></li>
<li><p>Battery Current Max Regen: -20A</p></li>
</ul>
</li>
<li><p>Under the battery cutoff voltage wizard, just enter the correct number of cells (12S) and ensure that Lithium Ion is selected.</p>
<ul class="simple">
<li><p>Click on <code class="docutils literal notranslate"><span class="pre">Apply</span></code> and the battery voltage settings will be set automatically</p></li>
</ul>
</li>
<li><p>In the sensor mode, select <code class="docutils literal notranslate"><span class="pre">Hall</span> <span class="pre">Sensors</span></code>.</p></li>
<li><p>Prop up the robot such that the wheels are not touching the ground (ensure that the wheels are attached to ensure the correct loading on the motors).</p></li>
<li><p>Proceed to the FOC settings wizard.</p>
<a class="reference internal image-reference" href="../_images/1555308490615.png"><img alt="../_images/1555308490615.png" src="../_images/1555308490615.png" style="width: 100%;"/></a>
<ul class="simple">
<li><p>Press the RL button, the motor will begin to vibrate</p></li>
<li><p>Then press the lamba button, the motor will begin to spin</p></li>
<li><p>After all red boxes turn green (indicating that VESC has detected the motor parameters), click on <code class="docutils literal notranslate"><span class="pre">apply</span></code> to apply the motor values.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/1555308481700.png"><img alt="../_images/1555308481700.png" src="../_images/1555308481700.png" style="width: 100%;"/></a>
</li>
<li><p>Under the Hall Sensor Detection wizard, ensure the motors can rotate freely.</p>
<ul class="simple">
<li><p>Then hit the play button.</p></li>
<li><p>After the motors rotate and all the Hall sensor values have been detected, click <code class="docutils literal notranslate"><span class="pre">apply</span></code>.</p></li>
</ul>
</li>
<li><p>Finish the motor setup wizard</p></li>
</ol>
</section>
<section id="app-settings">
<h3>App Settings<a class="headerlink" href="#app-settings" title="Permalink to this headline">¶</a></h3>
<p>Next the app settings has to be configured accordingly. For MOMO control, we will be using PPM directly from the Teensy. Information for configuring VESC for RC can be found at the [RC configuration guide](&lt;<a class="reference external" href="https://cdn.shopify.com/s/files/1/0011/4039/1996/files/Input_Setup_Wizard_for_single_VESC_using_a_PPM_signal_radio_controller.pdf?11313553160569203029">https://cdn.shopify.com/s/files/1/0011/4039/1996/files/Input_Setup_Wizard_for_single_VESC_using_a_PPM_signal_radio_controller.pdf?11313553160569203029</a>&gt; ).</p>
<ol class="arabic simple">
<li><p>Navigate to the <cite>App Settings</cite> in the left menu and select <code class="docutils literal notranslate"><span class="pre">Input</span> <span class="pre">Setup</span> <span class="pre">Wizard</span></code> at the bottom.</p></li>
<li><p>Configure the general app settings as follows:</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/1555308468557.png"><img alt="../_images/1555308468557.png" src="../_images/1555308468557.png" style="width: 100%;"/></a>
<ol class="arabic simple" start="3">
<li><p>Configure the PPM settings as follows:</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/Capture.png"><img alt="../_images/Capture.png" src="../_images/Capture.png" style="width: 100%;"/></a>
<p>(Alternatively, using ROS / Teensy, send a neutral signal and monitor
what PPM is being detected and use that as the center instead. Then
apply the maximum forward and reverse and use those as the start and
end values accordingly.)</p>
<ol class="arabic simple" start="4">
<li><p>Finally, set the Duty Settings as follows:</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/Capture2.png"><img alt="../_images/Capture2.png" src="../_images/Capture2.png" style="width: 100%;"/></a>
<ol class="arabic simple" start="5">
<li><p>Remember to write the configuration to the VESC.</p></li>
</ol>
<p>That’s it! The VESC should be configured for FOC.</p>
</section>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cd_links.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Circuit Diagram Draw.io Links</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../com/software.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Software</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021 SUTD Organisation of Autonomous Robotics
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../_sources/bonus/vesc_doc.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Flipsky VESC 4.12 Documentation</a><ul>
<li><a class="reference internal" href="#contribution-guidelines">Contribution Guidelines</a></li>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#flipsky-vesc-4-12">Flipsky VESC 4.12</a><ul>
<li><a class="reference internal" href="#firmware">Firmware</a></li>
<li><a class="reference internal" href="#specifications">Specifications</a></li>
<li><a class="reference internal" href="#connections">Connections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#software-setup">Software Setup</a><ul>
<li><a class="reference internal" href="#motor-connection-and-setup">Motor Connection and Setup</a></li>
<li><a class="reference internal" href="#app-settings">App Settings</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/main.js"></script>
    </body>
</html>